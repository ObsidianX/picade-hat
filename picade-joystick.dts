/dts-v1/;
/plugin/;
#include <linux/input-event-codes.h>

/ {
	compatible = "brcm,bcm2835", "brcm,bcm2708", "brcm,bcm2709";

	fragment@0 {
		target = <&gpio>;
		__overlay__ {
			picade_pins: picade_pins {
				brcm,pins = <5 6 8 9 10 11 12 16 20 22 23 24 25 27>;
				brcm,function = <0>;
				brcm,pull = <2>;
			};
			power_ctrl_pins: power_ctrl_pins {
				brcm,pins = <4>;
				brcm,function = <1>;
			};
			shutdown_button_pins: shutdown_button_pins {
				brcm,pins = <17>;
				brcm,function = <0>;
			};
		};
	};
	
	fragment@1 {
		target-path = "/";
		__overlay__ {
			power_ctrl: power_ctrl {
				compatible = "gpio-poweroff";
				gpios = <&gpio 4 1>;
				force;
			};
		};
	};

	fragment@2 {
		target-path = "/";
		__overlay__ {
			gpio_keys: gpio_keys {
				compatible = "gpio-keys";
				pinctrl-names = "default";
				pinctrl-0 = <&picade_pins>;
				status = "okay";

				/*up_joy: up_joy {
					label = "Up";
					linux,input-type = <EV_ABS>;
					linux,code = <ABS_Y>;
					linux,input-value = <1>;
					gpios = <&gpio 12 1>; 
				};

				down_joy: down_joy {
					label = "Down";
					linux,input-type = <EV_ABS>;
					linux,code = <ABS_Y>;
					linux,input-value = <0xffffffff>; // -1
					gpios = <&gpio 6 1>;
				};

				left_joy: left_joy {
					label = "Left";
					linux,input-type = <EV_ABS>;
					linux,code = <ABS_X>;
					linux,input-value = <0xffffffff>; // -1
					gpios = <&gpio 20 1>;
				};

				right_joy: right_joy {
					label = "Right";
					linux,input-type = <EV_ABS>;
					linux,code = <ABS_X>;
					linux,input-value = <1>;
					gpios = <&gpio 16 1>;
				};*/

				up: up {
					label = "Up";
					linux,code = <KEY_UP>;
					gpios = <&gpio 12 1>;
				};

				down: down {
					label = "Down";
					linux,code = <KEY_DOWN>;
					gpios = <&gpio 6 1>;
				};

				left: left {
					label = "Left";
					linux,code = <KEY_LEFT>;
					gpios = <&gpio 20 1>;
				};

				right: right {
					label = "Right";
					linux,code = <KEY_RIGHT>;
					gpios = <&gpio 16 1>;
				};

				button1: button1 {
					label = "Yellow Top";
					linux,code = <BTN_A>;
					gpios = <&gpio 5 1>;
				};

				button2: button2 {
					label = "Pink Top";
					linux,code = <BTN_B>;
					gpios = <&gpio 11 1>;
				};

				button3: button3 {
					label = "Blue Top";
					linux,code = <BTN_C>;
					gpios = <&gpio 8 1>;
				};

				button4: button4 {
					label = "Blue Bottom";
					linux,code = <BTN_Z>;
					gpios = <&gpio 25 1>;
				};

				button5: button5 {
					label = "Pink Bottom";
					linux,code = <BTN_Y>;
					gpios = <&gpio 9 1>;
				};

				button6: button6 {
					label = "Yellow Bottom";
					linux,code = <BTN_X>;
					gpios = <&gpio 10 1>;
				};

				enter: enter {
					label = "Right Black";
					linux,code = <BTN_TR2>;
					gpios = <&gpio 27 1>;
				};

				escape: escape {
					label = "Left Black";
					linux,code = <BTN_TL2>;
					gpios = <&gpio 22 1>;
				};

				coin: coin {
					label = "Front Left Black";
					linux,code = <BTN_TL>;
					gpios = <&gpio 23 1>;
				};

				start: start {
					label = "Front Right Black";
					linux,code = <BTN_TR>;
					gpios = <&gpio 24 1>;
				};
			};
		};
	};

	fragment@3 {
		target = <&i2s_pins>;
		__overlay__ {
			/*
			We cannot share BCM 20 between gpio keys (Left) and i2s (PCM_DIN)
			Assign PCM_DIN to the HAT EEPROM (ID_SD) pin which should be generally unused.
			*/
			brcm,pins = <18 19 0 21>;
			brcm,function = <4 4 0 4>;
		};
	};

	fragment@4 {
		target = <&i2s>;
		__overlay__ {
			status = "okay";
		};
	};

	fragment@5 {
		target-path = "/";
		__overlay__ {
			pcm5102a-codec {
				#sound-dai-cells = <0>;
				compatible = "ti,pcm5102a";
				status = "okay";
			};
		};
	};

	fragment@6 {
		target = <&sound>;
		__overlay__ {
			compatible = "hifiberry,hifiberry-dac";
			i2s-controller = <&i2s>;
			status = "okay";
		};
	};

	fragment@7 {
		target = <&act_led>;
		__overlay__ {
			linux,default-trigger = "default-on";
			gpios = <&gpio 13 1>;
		};
	};

	fragment@8 {
		target = <&gpio_keys>;
		__overlay__ {
			power: power {
				label = "Power";
				linux,code = <116>; // KEY_POWER
				gpios = <&gpio 17 1>;
			};
		};
	};

	__overrides__ {
		/*up_joy = <&up_joy>,"linux,code:0";
		down_joy = <&down_joy>,"linux,code:0";
		left_joy = <&left_joy>,"linux,code:0";
		right_joy = <&right_joy>,"linux,code:0";*/
		up = <&up>,"linux,code:0";
		down = <&down>,"linux,code:0";
		left = <&left>,"linux,code:0";
		right = <&right>,"linux,code:0";
		button1 = <&button1>,"linux,code:0";
		button2 = <&button2>,"linux,code:0";
		button3 = <&button3>,"linux,code:0";
		button4 = <&button4>,"linux,code:0";
		button5 = <&button5>,"linux,code:0";
		button6 = <&button6>,"linux,code:0";
		enter = <&enter>,"linux,code:0";
		escape = <&escape>,"linux,code:0";
		coin = <&coin>,"linux,code:0";
		start = <&start>,"linux,code:0";
		led-trigger = <&act_led>,"linux,default-trigger";
		noaudio = <0>,"-3-4-5-6";
		noactled = <0>,"-7";
		nopowerbtn = <0>,"-8";
		nopoweroff = <0>,"-1";
	};
};
